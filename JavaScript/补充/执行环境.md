# 1、词法作用域和动态作用域

**作用域**是指程序源代码中定义变量的区域，确定了当前执行代码对变量的访问权限。

作用域分为静态作用域（词法作用域）和动态作用域。

静态作用域在**函数定义的时候**就决定了，JavaScript 采用的就是这种作用域。

动态作用域是在函数调用的时候才决定的。



# 2、执行上下文栈

 JavaScript 引擎并非一行一行地分析和执行程序，而是一段一段地分析执行。当执行一段代码的时候，会存在变量声明提升和函数声明提升。

JavaScript 的可执行代码有 **全局代码**、**函数代码**、**eval** 代码三种。

JavaScript 引擎会创建**执行上下文栈**（Execution context stack, ECS）来管理**执行上下文**。



# 3、执行上下文（execution context）

当 JavaScript 代码执行一段可执行代码时，会创建对应的**执行上下文**（执行环境）。

每个执行上下文，有三个重要属性：变量对象（Variable object， VO）、作用域链（Scope chain）、this。

## 3.1、变量对象

执行上下文定义了变量或函数有权访问的其他数据。每个**执行上下文**都与之**关联**一个**变量对象**，变量对象中存储了在上下文中定义的变量和函数声明。

### 全局上下文

> **全局对象**是预定义的对象，作为 JavaScript 的全局函数和全局属性的占位符。通过使用全局对象，可以访问所有其他所有预定义的对象、函数和属性。

> 在顶层 JavaScript 代码中，可以用关键字 this 引用全局对象。因为全局对象是作用域链的头，这意味着所有非限定性的变量和函数名都会作为该对象的属性来查询。

在全局上下文中的变量对象就是全局对象（在浏览器中就是 Window 对象）。

### 函数上下文

每个函数都有自己的执行上下文。当执行流进入一个函数时，函数的上下文就会被推入到执行上下文栈中。而在函数执行之后，栈将其上下文弹出，把控制权返回给之前的执行上下文。

### 执行过程

执行上下文的代码会分成两个阶段进行处理：分析和执行，也可以叫做 进入执行上下文和代码执行。

**进入执行上下文**：

这时还没有执行代码，变量对象会包括函数的所有形参（如果是函数上下文）、函数**声明**、变量**声明**。

**代码执行**：

在代码执行阶段，会顺序执行代码，根据代码，修改变量对象的值。

### 变量对象总结：

1. 全局上下文的变量对象初始化时全局对象
2. 函数上下文的变量对象初始化只包括 Arguments 对象
3. 在进入执行上下文时会给变量对象添加形参、函数声明、变量声明等初始的属性值
4. 在代码执行阶段，会再次修改变量对象的属性值



## 3.2 作用域链

当代码在一个执行上下文中执行时，会创建变量对象的一个**作用域链**。**作用域链的用途**是保证对执行上下文有权访问的所有变量和函数的有序访问。

作用域链的前端，始终都是**当前**执行的代码所在环境的**变量对象**。当查找变量的时候，会先从当前上下文的变量对象中查找，如果没有找到，就会从父级(词法层面上的父级)执行上下文的变量对象中查找，一直找到全局上下文的变量对象，也就是全局对象。内部环境可以通过作用域链访问所有的外部环境，但外部环境不能访问内部环境中的任何变量和函数。



## 3.3 this 对象

this 对象是在**运行时**基于函数的执行环境绑定的：在全局函数中，this 等于 window，而当函数被作为某个对象的方法调用时，this 等于那个对象。